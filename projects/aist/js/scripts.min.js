'use strict';

$(document).ready(function () {
  // слайдер на головній сторнці
  $('.slider-main, .slider-forgotten').slick({
    arrows: false,
    dots: true
  });
  $('.discounts-slider').slick({
    arrows: false,
    slidesToShow: 2
  });
  $('.nav-tabs').on('click', '.item', function (e) {
    e.preventDefault();
    var id = $(this).attr('data-content');
    $(this).parents('.nav-tabs').find('.active').removeClass('active');
    $(this).addClass('active');
    $('body').find(id).parents('.tab-content').find('.active').removeClass('active');
    $('body').find(id).addClass('active');
  }); // попапи

  $('.popup').magnificPopup({
    type: 'inline',
    fixedContentPos: false,
    fixedBgPos: true,
    overflowY: 'auto',
    closeBtnInside: true,
    preloader: false,
    midClick: true,
    removalDelay: 300,
    mainClass: 'mfp-zoom-in',
    callbacks: {
      open: function open() {
        $('body').css('overflow', 'hidden');
        $('.slider-forgotten').slick('setPosition');
      },
      close: function close() {
        $('body').css('overflow', '');
      }
    }
  });
  $('body').on('click', '.close-popup', function () {
    $.magnificPopup.close({
      mainClass: 'mfp-zoom-in'
    });
  });
  var counter = $('.counter');
  counter.on('click', '.num', function () {
    var valInput = $(this).parents('.counter').find('input'),
        valCounter = valInput.val();

    if ($(this).hasClass('plus-btn')) {
      valCounter++;
    } else {
      if (valCounter >= 1) {
        valCounter--;
      }
    }

    valInput.val(valCounter);
  }); // перемикач слайда

  $('.slide-container').on('click', '.btn-slide', function () {
    $(this).parents('.slide-container').find('.content').slideToggle();
    $(this).parents('.slide-container').toggleClass('active');
  }); // якір

  $(".go-to").on('click', function (e) {
    e.preventDefault();
    var anchor = $(this).attr("href");

    if ($(anchor).length) {
      var run = $(anchor).offset().top;
      $('body,html').stop().animate({
        scrollTop: run
      }, 1500);
    } else {
      console.warn("ID don't search!");
    }
  });
  $(".button-mobile-menu, .mobile-menu .close").on("click", function () {
    $('.mobile-menu, html').toggleClass('show');
  }); // сортування в таблиці

  $(".sortable").sortable({
    axis: "y"
  }); // показує активну лінку горизонтальному слайді

  $('.line-products').each(function () {
    var left = $(this).find('.active').offset().left,
        width = $(this).innerWidth(),
        activeWidth = $(this).find('.active').innerWidth();

    if (width < left + activeWidth) {
      $(this).scrollLeft(left - 12);
    }
  }); // перемикач між таблицею і карточками

  $('.cards-table-slide').on('click', '.item', function () {
    var $this = $(this),
        slide = $this.attr('data-slide'),
        id = $this.attr('data-id');
    $('.cards-table-slide').find('.item').removeClass('active');
    $this.parents('.cards-table-slide').find('.slide .active').removeClass('active');
    $this.addClass('active');
    $this.parents('.cards-table-slide').find('.slide').attr('data-active', slide);
    $('.cards-table-content').find('.active').removeClass('active');
    $(id).addClass('active');
  });
  $('.cards-table-slide').on('click', '.slide', function () {
    var $this = $(this);
    $this.parents('.cards-table-slide').find('.item').each(function () {
      if ($(this).hasClass('active')) {
        $(this).removeClass('active');
      } else {
        $(this).addClass('active');
        var id = $(this).attr('data-id'),
            activeSlide = $(this).attr('data-slide');
        $('.cards-table-content').find('.active').removeClass('active');
        $(id).addClass('active');
        $this.attr('data-active', activeSlide);
      }
    });
  }); // календар

  $.datepicker.regional['ru'] = {
    closeText: 'Закрыть',
    prevText: 'Пред',
    nextText: 'След',
    currentText: 'Сегодня',
    monthNames: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
    monthNamesShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
    dayNames: ['воскресенье', 'понедельник', 'вторник', 'среда', 'четверг', 'пятница', 'суббота'],
    dayNamesShort: ['вск', 'пнд', 'втр', 'срд', 'чтв', 'птн', 'сбт'],
    dayNamesMin: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
    weekHeader: 'Нед',
    dateFormat: 'dd.mm.yy',
    firstDay: 1,
    isRTL: false,
    showMonthAfterYear: false,
    yearSuffix: ''
  };
  $.datepicker.setDefaults($.datepicker.regional['ru']);
  $('.datepicker').datepicker();

  $.fn.forceNumbericOnly = function () {
    return this.each(function () {
      $(this).keydown(function (e) {
        var key = e.charCode || e.keyCode || 0;
        return key == 8 || key == 9 || key == 46 || key >= 37 && key <= 40 || key >= 48 && key <= 57 || key >= 96 && key <= 105 || key == 107 || key == 109 || key == 173 || key == 61;
      });
    });
  };

  $('input[type=tel]').forceNumbericOnly(); // dropdown menu

  var $dropdown = $('.dropdown');
  $dropdown.on('click', '.arrow-btn', function () {
    if ($(this).hasClass('active')) {
      $(this).parents('.dropdown').find('.content').slideUp();
      $(this).removeClass('active');
    } else {
      $('.content').slideUp();
      $('.arrow-btn').removeClass('active');
      $(this).parents('.dropdown').find('.content').slideDown();
      $(this).addClass('active');
    }
  });
  $dropdown.on('click', '.item', function () {
    $(this).parents('.content').slideToggle();
    var text = $(this).text();
    $(this).parents('.dropdown').find('.arrow-btn').toggleClass('active');
    $(this).parents('.dropdown').find('.arrow-btn').text(text);
  });
});